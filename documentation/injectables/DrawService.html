<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>labelmed documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">labelmed documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >DrawService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/Components/Core/drawable-canvas/service/draw.service.ts</code>
        </p>





            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#lassoPoints" >lassoPoints</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#redrawRequest" >redrawRequest</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#singleDrawRequest" >singleDrawRequest</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#applyLasso" >applyLasso</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#applyLassoEraser" >applyLassoEraser</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#binarizeCanvas" >binarizeCanvas</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#clearCanvas" >clearCanvas</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#draw" >draw</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#drawPen" >drawPen</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#endDraw" >endDraw</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#eraserPen" >eraserPen</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#finalizeDraw" >finalizeDraw</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#getFillColor" >getFillColor</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#postProcessDraw" >postProcessDraw</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#postProcessErase" >postProcessErase</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#refreshAllColors" >refreshAllColors</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#refreshColor" >refreshColor</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#startDraw" >startDraw</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#swapMarkers" >swapMarkers</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#updateLasso" >updateLasso</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#wheel" >wheel</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(labelService: <a href="../injectables/LabelsService.html" target="_self">LabelsService</a>, openCVService: <a href="../injectables/OpenCVService.html" target="_self">OpenCVService</a>, projectService: <a href="../injectables/ProjectService.html" target="_self">ProjectService</a>, zoomPanService: <a href="../injectables/ZoomPanService.html" target="_self">ZoomPanService</a>, editorService: <a href="../injectables/EditorService.html" target="_self">EditorService</a>, stateService: <a href="../injectables/StateManagerService.html" target="_self">StateManagerService</a>, canvasManagerService: <a href="../injectables/CanvasManagerService.html" target="_self">CanvasManagerService</a>, undoRedoService: <a href="../injectables/UndoRedoService.html" target="_self">UndoRedoService</a>, postProcessService: <a href="../injectables/PostProcessService.html" target="_self">PostProcessService</a>, svgUIService: <a href="../injectables/SVGUIService.html" target="_self">SVGUIService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="24" class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:24</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>labelService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/LabelsService.html" target="_self" >LabelsService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>openCVService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/OpenCVService.html" target="_self" >OpenCVService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>projectService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/ProjectService.html" target="_self" >ProjectService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>zoomPanService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/ZoomPanService.html" target="_self" >ZoomPanService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>editorService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/EditorService.html" target="_self" >EditorService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>stateService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/StateManagerService.html" target="_self" >StateManagerService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>canvasManagerService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/CanvasManagerService.html" target="_self" >CanvasManagerService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>undoRedoService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/UndoRedoService.html" target="_self" >UndoRedoService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>postProcessService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/PostProcessService.html" target="_self" >PostProcessService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>svgUIService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/SVGUIService.html" target="_self" >SVGUIService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="applyLasso"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>applyLasso</b></span>
                        <a href="#applyLasso"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>applyLasso()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="59"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:59</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="applyLassoEraser"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>applyLassoEraser</b></span>
                        <a href="#applyLassoEraser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>applyLassoEraser(ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="105"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:105</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>ctx</td>
                                            <td>
                                                        <code>CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="binarizeCanvas"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>binarizeCanvas</b></span>
                        <a href="#binarizeCanvas"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>binarizeCanvas(ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D, color: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="127"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:127</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>ctx</td>
                                            <td>
                                                        <code>CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>color</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="clearCanvas"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>clearCanvas</b></span>
                        <a href="#clearCanvas"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>clearCanvas(ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="137"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:137</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>ctx</td>
                                            <td>
                                                        <code>CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="draw"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>draw</b></span>
                        <a href="#draw"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>draw(event: MouseEvent)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="143"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:143</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>event</td>
                                            <td>
                                                        <code>MouseEvent</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="drawPen"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>drawPen</b></span>
                        <a href="#drawPen"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>drawPen(ctx: OffscreenCanvasRenderingContext2D)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="188"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:188</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>ctx</td>
                                            <td>
                                                        <code>OffscreenCanvasRenderingContext2D</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="endDraw"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>endDraw</b></span>
                        <a href="#endDraw"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>endDraw()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="211"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:211</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="eraserPen"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>eraserPen</b></span>
                        <a href="#eraserPen"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>eraserPen(ctx: OffscreenCanvasRenderingContext2D)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="280"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:280</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>ctx</td>
                                            <td>
                                                        <code>OffscreenCanvasRenderingContext2D</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="finalizeDraw"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>finalizeDraw</b></span>
                        <a href="#finalizeDraw"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>finalizeDraw(ctx: OffscreenCanvasRenderingContext2D)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="330"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:330</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>ctx</td>
                                            <td>
                                                        <code>OffscreenCanvasRenderingContext2D</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getFillColor"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>getFillColor</b></span>
                        <a href="#getFillColor"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getFillColor()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="334"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:334</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="postProcessDraw"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>postProcessDraw</b></span>
                        <a href="#postProcessDraw"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>postProcessDraw()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="346"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:346</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="postProcessErase"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>postProcessErase</b></span>
                        <a href="#postProcessErase"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>postProcessErase()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="361"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:361</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="refreshAllColors"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>refreshAllColors</b></span>
                        <a href="#refreshAllColors"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>refreshAllColors()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="408"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:408</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="refreshColor"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>refreshColor</b></span>
                        <a href="#refreshColor"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>refreshColor(inputCtx: OffscreenCanvasRenderingContext2D | null, inputColor: string | null)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="365"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:365</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>inputCtx</td>
                                            <td>
                                                        <code>OffscreenCanvasRenderingContext2D | null</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>null</code>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>inputColor</td>
                                            <td>
                                                        <code>string | null</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>null</code>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="startDraw"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>startDraw</b></span>
                        <a href="#startDraw"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>startDraw()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="417"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:417</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="swapMarkers"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>swapMarkers</b></span>
                        <a href="#swapMarkers"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>swapMarkers()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="425"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:425</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateLasso"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>updateLasso</b></span>
                        <a href="#updateLasso"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateLasso(event: MouseEvent)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="478"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:478</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>event</td>
                                            <td>
                                                        <code>MouseEvent</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="wheel"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>wheel</b></span>
                        <a href="#wheel"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>wheel(event: WheelEvent)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="484"
                                    class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:484</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>event</td>
                                            <td>
                                                        <code>WheelEvent</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="lassoPoints"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>lassoPoints</b></span>
                        <a href="#lassoPoints"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>Point2D[]</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>[]</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="21" class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:21</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="redrawRequest"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>redrawRequest</b></span>
                        <a href="#redrawRequest"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new Subject&lt;boolean&gt;()</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="22" class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:22</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="singleDrawRequest"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>singleDrawRequest</b></span>
                        <a href="#singleDrawRequest"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new Subject&lt;OffscreenCanvasRenderingContext2D | null&gt;()</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="23" class="link-to-prism">src/app/Components/Core/drawable-canvas/service/draw.service.ts:23</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@angular/core&#x27;;
import { Point2D } from &#x27;../models&#x27;;
import { LabelsService } from &#x27;../../../../Services/Project/labels.service&#x27;;
import { OpenCVService } from &#x27;../../../../Services/open-cv.service&#x27;;
import { ProjectService } from &#x27;../../../../Services/Project/project.service&#x27;;
import { ZoomPanService } from &#x27;./zoom-pan.service&#x27;;
import { Tools } from &#x27;../../../../Core/canvases/tools&#x27;;
import { EditorService } from &#x27;../../../../Services/UI/editor.service&#x27;;
import { StateManagerService } from &#x27;./state-manager.service&#x27;;
import { Subject } from &#x27;rxjs&#x27;;
import { CanvasManagerService } from &#x27;./canvas-manager.service&#x27;;
import { UndoRedoService } from &#x27;./undo-redo.service&#x27;;
import { PostProcessService } from &#x27;./post-process.service&#x27;;
import { SVGUIService } from &#x27;./svgui.service&#x27;;
import { PostProcessOption } from &#x27;../../../../Core/canvases/tools&#x27;;

@Injectable({
  providedIn: &#x27;root&#x27;,
})
export class DrawService {
  public lassoPoints: Point2D[] &#x3D; [];
  public redrawRequest &#x3D; new Subject&lt;boolean&gt;();
  public singleDrawRequest &#x3D;
    new Subject&lt;OffscreenCanvasRenderingContext2D | null&gt;();

  constructor(
    private labelService: LabelsService,
    private openCVService: OpenCVService,
    private projectService: ProjectService,
    private zoomPanService: ZoomPanService,
    private editorService: EditorService,
    private stateService: StateManagerService,
    private canvasManagerService: CanvasManagerService,
    private undoRedoService: UndoRedoService,
    private postProcessService: PostProcessService,
    private svgUIService: SVGUIService
  ) {
    this.editorService.canvasSumRefresh.subscribe((value) &#x3D;&gt; {
      this.canvasManagerService.computeCombinedCanvas();
      this.redrawRequest.next(true);
    });

    this.editorService.canvasRedraw.subscribe((value) &#x3D;&gt; {
      if (value) {
        this.stateService.recomputeCanvasSum &#x3D; value;
        this.refreshColor();
      }
    });

    this.editorService.canvasClear.subscribe((value) &#x3D;&gt; {
      if (value &gt;&#x3D; 0) {
        this.stateService.recomputeCanvasSum &#x3D; true;
        this.canvasManagerService.clearCanvasAtIndex(value);
        this.redrawRequest.next(true);
      }
    });
  }

  public applyLasso() {
    if (this.lassoPoints.length &lt; 3) {
      return;
    }
    let ctx &#x3D; this.canvasManagerService.getBufferCtx();
    ctx.strokeStyle &#x3D; this.getFillColor();
    ctx.fillStyle &#x3D; this.getFillColor();
    ctx.lineWidth &#x3D; 0;
    ctx.globalCompositeOperation &#x3D; &#x27;source-over&#x27;;
    let prev: Point2D &#x3D; this.lassoPoints[0];
    ctx.beginPath();
    ctx.moveTo(prev.x, prev.y);
    for (let i &#x3D; 1; i &lt; this.lassoPoints.length; i++) {
      const canvasCoord &#x3D; this.lassoPoints[i];
      ctx.lineTo(canvasCoord.x, canvasCoord.y);
    }
    ctx.closePath();
    for (let i &#x3D; 0; i &lt; 20; i++) {
      ctx.fill();
    }

    if (this.editorService.swapMarkers) {
      this.swapMarkers();
    }

    if (!this.editorService.autoPostProcess) {
      let bbox &#x3D; this.stateService.getBoundingBox();
      this.canvasManagerService
        .getActiveCtx()
        .drawImage(
          ctx.canvas,
          bbox.x,
          bbox.y,
          bbox.width,
          bbox.height,
          bbox.x,
          bbox.y,
          bbox.width,
          bbox.height
        );
    }

    this.lassoPoints &#x3D; [];
    ctx.globalCompositeOperation &#x3D; &#x27;source-over&#x27;;
  }

  public applyLassoEraser(
    ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D
  ) {
    if (this.lassoPoints.length &lt; 3) {
      return;
    }
    ctx.strokeStyle &#x3D; this.getFillColor();
    ctx.fillStyle &#x3D; this.getFillColor();
    ctx.lineWidth &#x3D; 0;
    ctx.globalCompositeOperation &#x3D; &#x27;destination-out&#x27;;
    let prev: Point2D &#x3D; this.lassoPoints[0];
    ctx.beginPath();
    ctx.moveTo(prev.x, prev.y);
    for (let i &#x3D; 1; i &lt; this.lassoPoints.length; i++) {
      const canvasCoord &#x3D; this.lassoPoints[i];
      ctx.lineTo(canvasCoord.x, canvasCoord.y);
    }
    ctx.closePath();
    ctx.fill();
    ctx.globalCompositeOperation &#x3D; &#x27;source-over&#x27;;
  }

  public binarizeCanvas(
    ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D,
    color: string
  ) {
    let bbox &#x3D; this.stateService.getBoundingBox();
    if (!this.projectService.isInstanceSegmentation) {
      this.openCVService.binarizeCanvas(ctx, color, bbox);
    }
  }

  public clearCanvas(
    ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D
  ) {
    ctx.clearRect(0, 0, this.stateService.width, this.stateService.height);
  }

  public draw(event: MouseEvent) {
    if (!this.stateService.isDrawing) {
      return;
    }
    if (!this.labelService.activeLabel) {
      return;
    }
    let ctx &#x3D; this.canvasManagerService.getBufferCtx();
    if (!ctx) {
      return;
    }
    this.stateService.recomputeCanvasSum &#x3D; true;
    const imageCoord &#x3D; this.zoomPanService.getImageCoordinates(event);
    const x &#x3D; imageCoord.x;
    const y &#x3D; imageCoord.y;

    this.stateService.updateMinMaxPoints({ x, y });

    ctx.fillStyle &#x3D; this.getFillColor();
    ctx.strokeStyle &#x3D; this.getFillColor();
    ctx.lineWidth &#x3D; this.editorService.lineWidth;
    // Deactivate anti-aliasing
    ctx.imageSmoothingEnabled &#x3D; false;
    ctx.lineCap &#x3D; &#x27;round&#x27;;
    if (this.stateService.isFirstStroke()) {
      this.stateService.updatePreviousPoint(imageCoord);
    }
    this.stateService.updateCurrentPoint(imageCoord);
    switch (this.editorService.selectedTool) {
      case Tools.PEN:
        this.drawPen(ctx);
        break;
      case Tools.ERASER:
        this.eraserPen(ctx);
        break;
      case Tools.LASSO:
        this.updateLasso(event);
        break;
      case Tools.LASSO_ERASER:
        this.updateLasso(event);
        break;
    }
    this.stateService.updatePreviousPoint(imageCoord);
  }

  public drawPen(ctx: OffscreenCanvasRenderingContext2D) {
    // Initialize previous point if not set

    ctx.globalCompositeOperation &#x3D; &#x27;source-over&#x27;;
    ctx.imageSmoothingEnabled &#x3D; false;

    ctx.beginPath();
    ctx.moveTo(
      this.stateService.previousPoint.x,
      this.stateService.previousPoint.y
    );
    ctx.lineTo(
      this.stateService.currentPoint.x,
      this.stateService.currentPoint.y
    );
    ctx.stroke();

    // this.binarizeCanvas(ctx, this.getFillColor());

    // Update previous point
    this.finalizeDraw(ctx);
  }

  public async endDraw() {
    if (!this.stateService.isDrawing) {
      return;
    }
    this.stateService.recomputeCanvasSum &#x3D; true;
    let bufferCtx &#x3D; this.canvasManagerService.bufferCtx;
    let activeCtx &#x3D; this.canvasManagerService.getActiveCtx();
    this.binarizeCanvas(bufferCtx, this.getFillColor());
    this.stateService.recomputeCanvasSum &#x3D; true;
    switch (this.editorService.selectedTool) {
      case Tools.PEN:
        let bbox &#x3D; this.stateService.getBoundingBox();
        if (!this.editorService.autoPostProcess) {
          if (this.editorService.swapMarkers) {
            this.swapMarkers();
          } else {
            activeCtx.drawImage(
              this.canvasManagerService.getBufferCanvas(),
              bbox.x,
              bbox.y,
              bbox.width,
              bbox.height,
              bbox.x,
              bbox.y,
              bbox.width,
              bbox.height
            );
          }
        }
        break;
      case Tools.ERASER:
        break;
      case Tools.LASSO:
        this.applyLasso();
        break;
      case Tools.LASSO_ERASER:
        if (this.editorService.eraseAll) {
          this.canvasManagerService.getAllCanvasCtx().forEach((ctx) &#x3D;&gt; {
            this.applyLassoEraser(ctx);
          });
        } else {
          this.applyLassoEraser(activeCtx);
        }
        this.lassoPoints &#x3D; [];
        break;
    }
    this.stateService.isDrawing &#x3D; false;

    let postProcessCallback &#x3D; new Promise&lt;void&gt;((resolve) &#x3D;&gt; {
      resolve();
    });
    if (this.editorService.autoPostProcess) {
      if (this.editorService.isEraser()) {
        postProcessCallback &#x3D; this.postProcessErase();
      } else if (this.editorService.isDrawingTool()) {
        postProcessCallback &#x3D; this.postProcessDraw();
      }
    }
    await postProcessCallback?.then(() &#x3D;&gt; {
      this.redrawRequest.next(true);
    });

    if (this.projectService.isInstanceSegmentation) {
      if (this.editorService.incrementAfterStroke) {
        this.labelService.incrementActiveInstance();
      }
    }
  }

  public eraserPen(ctx: OffscreenCanvasRenderingContext2D) {
    // Is auto post-processing enabled? In which case, ctx is a buffer canvas
    // and we need to draw on the buffer canvas instead of the active canvas
    // Otherwise, we draw on the active canvas or all class canvases if eraseAll is enabled

    ctx.globalCompositeOperation &#x3D; &#x27;source-over&#x27;;
    ctx.beginPath();
    ctx.moveTo(
      this.stateService.previousPoint.x,
      this.stateService.previousPoint.y
    );
    ctx.lineTo(
      this.stateService.currentPoint.x,
      this.stateService.currentPoint.y
    );
    ctx.stroke();

    this.binarizeCanvas(ctx, this.getFillColor());
    let bbox &#x3D; this.stateService.getBoundingBox();

    if (!this.editorService.autoPostProcess) {
      this.canvasManagerService.getAllCanvasCtx().forEach((ctxClass, index) &#x3D;&gt; {
        if (
          index !&#x3D; this.labelService.getActiveIndex() &amp;&amp;
          !this.editorService.eraseAll
        ) {
          return;
        }
        ctxClass.globalCompositeOperation &#x3D; &#x27;destination-out&#x27;;
        ctxClass.drawImage(
          ctx.canvas,
          bbox.x,
          bbox.y,
          bbox.width,
          bbox.height,
          bbox.x,
          bbox.y,
          bbox.width,
          bbox.height
        );
        ctxClass.globalCompositeOperation &#x3D; &#x27;source-over&#x27;;
      });
    } 
    else {
      this.svgUIService.addPoint(this.stateService.currentPoint);
    }

    this.redrawRequest.next(true);
  }

  public finalizeDraw(ctx: OffscreenCanvasRenderingContext2D) {
    this.singleDrawRequest.next(ctx);
  }

  public getFillColor() {
    if (this.projectService.isInstanceSegmentation) {
      if (!this.labelService.activeSegInstance) {
        throw new Error(&#x27;No active instance&#x27;);
      }
      return this.labelService.activeSegInstance.shade;
    }

    const color &#x3D; this.labelService.activeLabel?.color;
    return color ? color : &#x27;#ffffff&#x27;;
  }

  public postProcessDraw() {
    this.stateService.recomputeCanvasSum &#x3D; true;
    switch (this.editorService.postProcessOption) {
      case PostProcessOption.OTSU:
        return this.postProcessService.otsu_post_process();
      case PostProcessOption.MEDSAM:
        return this.postProcessService.sam_post_process();
      case PostProcessOption.CRF:
        return this.postProcessService.crf_post_process();
    }
    return new Promise&lt;void&gt;((resolve) &#x3D;&gt; {
      resolve();
    });
  }

  public async postProcessErase() {
    await this.postProcessService.eraseAll_post_process();
  }

  public refreshColor(
    inputCtx: OffscreenCanvasRenderingContext2D | null &#x3D; null,
    inputColor: string | null &#x3D; null
  ) {
    if (this.projectService.isInstanceSegmentation) {
      this.redrawRequest.next(true);
      return;
    }

    let ctx:
      | OffscreenCanvasRenderingContext2D
      | CanvasRenderingContext2D
      | null;
    if (!inputCtx) {
      ctx &#x3D; this.canvasManagerService.getActiveCtx();
    } else {
      ctx &#x3D; inputCtx;
    }
    if (!ctx) {
      ctx &#x3D;
        this.canvasManagerService.canvasCtx[
          this.canvasManagerService.canvasCtx.length - 1
        ];
      this.labelService.activeLabel &#x3D;
        this.labelService.listSegmentationLabels[
          this.labelService.listSegmentationLabels.length - 1
        ];
    }
    if (!ctx) {
      return;
    }
    let color &#x3D; inputColor ? inputColor : this.labelService.activeLabel?.color;

    ctx.fillStyle &#x3D; color ? color : &#x27;#ffffff&#x27;;
    ctx.strokeStyle &#x3D; color ? color : &#x27;#ffffff&#x27;;
    ctx.globalCompositeOperation &#x3D; &#x27;source-atop&#x27;;

    ctx.fillRect(0, 0, this.stateService.width, this.stateService.height);
    ctx.globalCompositeOperation &#x3D; &#x27;source-over&#x27;;

    this.redrawRequest.next(true);
  }

  public refreshAllColors() {
    this.canvasManagerService.getAllCanvasCtx().forEach((ctx, index) &#x3D;&gt; {
      this.refreshColor(
        ctx,
        this.labelService.listSegmentationLabels[index].color
      );
    });
  }

  public startDraw() {
    this.stateService.reset();
    this.stateService.isDrawing &#x3D; true;
    this.lassoPoints &#x3D; [];
    this.clearCanvas(this.canvasManagerService.bufferCtx);
    return this.undoRedoService.update_undo_redo();
  }

  public swapMarkers() {
    const activeIndex &#x3D; this.labelService.getActiveIndex();
    let ctx &#x3D; this.canvasManagerService.getBufferCtx();
    let bufferCanvas &#x3D; this.canvasManagerService.getBufferCanvas();
    ctx.fillStyle &#x3D; this.getFillColor();
    // We find the shape that overlap the current buffer with the other class canvas
    const rect &#x3D; this.stateService.getBoundingBox();
    ctx.globalCompositeOperation &#x3D; &#x27;source-in&#x27;;
    this.stateService.recomputeCanvasSum &#x3D; true;
    const edgesOnly &#x3D; this.editorService.edgesOnly;
    this.editorService.edgesOnly &#x3D; false;
    this.canvasManagerService.computeCombinedCanvas();
    this.editorService.edgesOnly &#x3D; edgesOnly;

    ctx.drawImage(
      this.canvasManagerService.getCombinedCanvas(),
      rect.x,
      rect.y,
      rect.width,
      rect.height,
      rect.x,
      rect.y,
      rect.width,
      rect.height
    );


    ctx.fillRect(rect.x, rect.y, rect.width, rect.height);
    ctx.globalCompositeOperation &#x3D; &#x27;source-over&#x27;;

    // Now, we remove the overlapped shape from the other class canvas
    this.canvasManagerService.getAllCanvasCtx().forEach((classCtx, index) &#x3D;&gt; {
      if (index &#x3D;&#x3D;&#x3D; activeIndex) {
        classCtx.globalCompositeOperation &#x3D; &#x27;source-over&#x27;;
      } else {
        classCtx.globalCompositeOperation &#x3D; &#x27;destination-out&#x27;;
      }
      classCtx.drawImage(
        bufferCanvas,
        rect.x,
        rect.y,
        rect.width,
        rect.height,
        rect.x,
        rect.y,
        rect.width,
        rect.height
      );
      classCtx.globalCompositeOperation &#x3D; &#x27;source-over&#x27;;
    });
    this.stateService.recomputeCanvasSum &#x3D; true;
  }

  public updateLasso(event: MouseEvent) {
    const canvasCoord &#x3D; this.zoomPanService.getImageCoordinates(event);

    this.lassoPoints.push(canvasCoord);
  }

  public wheel(event: WheelEvent) {
    if (event.ctrlKey) {
      this.editorService.lineWidth +&#x3D; event.deltaY &gt; 0 ? -2 : 2;
    } else {
      this.zoomPanService.wheel(event);
    }
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'DrawService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
